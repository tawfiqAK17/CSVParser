grammar:

Query             = GetQuery | SetQuery 
GetQuery          = "get" Selector WhereClause? FunctionCall?
FunctionCall      = Function FunctionCall*
Function          = NSort | NReverseSort | Sort | ReverseSort | Head | Tail
NSort             = "nsort" FieldName
NReverseSort      = "nrsort" FieldName
Sort              = "sort" FieldName
ReverseSort       = "rsort" FieldName
Head              = "head" Number
Tail              = "tail" Number
SetQuery          = "set" WhereClause? "to" AssignList
AssignList        = Assignment (Assignment)*
Assignment        = FieldName "=" Modification 
Selector          = "*" | FieldName
Modification      = Value Modifier? Value? 
WhereClause       = "where" Condition
Condition         = OrCondition
OrCondition       = AndCondition ("or" AndCondition)*
AndCondition      = NotCondition ("and" NotCondition)*
NotCondition      = "not"? PrimaryCondition
PrimaryCondition  = Comparison | "(" Condition ")"
Comparison        = FieldName ComparisonOp Value
Value             = PrimitiveValue | FieldName
ComparisonOp      = NumericalOp | StringOp
NumericalOp       = "==" | "!=" | ">" | "<" | ">=" | "<=" | BetweenOp
BetweenOp         = "between" (Number | FieldName) "and" (Number | FieldName)
StringOp          = "is" | "contains" | "starts-with" | "ends-with"
PrimitiveValue    = Literal | Number | Boolean | List
Modifier          = "+" | "-" | "*" | "/" | "%" | "concat" | "to-lower" | "to-upper"
Literal           = '"' [^"]* '"' | "'" [^']* "'"
Number            = Float
Boolean           = "true" | "false"
List              = "[" PrimitiveValue ("," PrimitiveValue)* "]" | GetQuery
FieldName         = $String
